#!/usr/bin/env php
<?php
set_include_path(join(PATH_SEPARATOR, array(
    realpath(__DIR__ . '/../src'),
    realpath(__DIR__ . '/../examples/src'),
    get_include_path(),
)));

require_once 'Speciphy/Autoloader.php';
Speciphy\Autoloader::register();
require_once 'Speciphy/DSL.php';

use Speciphy\Loader\SpecFileLoader;

$files = new SpecFileLoader($argv[1]);
foreach ($files as $file) {
    $exampleGroup = include $file->getRealpath();
    $iterator = new RecursiveIteratorIterator($exampleGroup);
    dump($exampleGroup);
}

function dump($iterator) {
    echo $iterator->getDescription(), PHP_EOL;
    _dump($iterator);
}

function _dump($iterator) {
    for ($iterator->rewind(); $iterator->valid(); $iterator->next()) {
        $current = $iterator->current();
        echo str_repeat('  ', $current->getNestLevel());
        echo $current->getDescription(), PHP_EOL;
        if ($iterator->hasChildren()) {
            _dump($iterator->getChildren());
        }
    }
}
